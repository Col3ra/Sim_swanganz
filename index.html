<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Swan–Ganz – Simulador Clínico</title>

<style>
:root{
  --bg:#07090c;
  --panel:#0f1217;
  --text:#eaf0ff;
  --muted:#9fb0cc;
  --green:#2ee58b;
  --yellow:#ffd13b;
  --red:#ff4d4d;
  --blue:#55b7ff;
  --gray:#8892a6;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background:radial-gradient(1200px 700px at 20% 0%, #0c1220 0%, var(--bg) 60%);
  color:var(--text);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  overflow:hidden;
}
.app{
  height:100dvh;
  display:flex;
  flex-direction:column;
  min-height:0;
}

/* ---------- TOP BAR ---------- */
.topbar{
  padding:10px 14px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:1px solid rgba(255,255,255,.08);
}
.badge{
  font-size:12px;
  padding:4px 8px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.15);
  color:var(--muted);
}
.status-warn{
  color:var(--red);
  font-weight:600;
}

/* ---------- MAIN ---------- */
.main{
  flex:1;
  min-height:0;
  display:grid;
  grid-template-columns:1fr 340px;
  gap:12px;
  padding:12px;
}

/* ---------- CURVA PRINCIPAL ---------- */
.wave{
  border:1px solid rgba(255,255,255,.08);
  border-radius:18px;
  position:relative;
  overflow:hidden;
}
.wave-label{
  position:absolute;
  top:8px;
  left:12px;
  font-weight:700;
}
.wave-value{
  position:absolute;
  top:8px;
  right:12px;
  font-variant-numeric:tabular-nums;
  color:var(--muted);
}
canvas{width:100%;height:100%}

/* ---------- SIDE ---------- */
.side{
  overflow:auto;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.tile{
  border:1px solid rgba(255,255,255,.08);
  border-radius:16px;
  padding:10px;
}
.tile h3{
  margin:0 0 6px;
  font-size:12px;
  color:var(--muted);
  text-transform:uppercase;
}
.big{
  font-size:clamp(32px,4vw,44px);
  font-weight:800;
}
.mini{
  font-size:13px;
  margin-top:4px;
  color:var(--muted);
}

/* ---------- FOOTER ---------- */
.footer{
  padding:10px;
  border-top:1px solid rgba(255,255,255,.08);
}
.controls{
  display:grid;
  grid-template-columns:repeat(6,1fr);
  gap:8px;
}
.ctrl{
  border:1px solid rgba(255,255,255,.08);
  border-radius:12px;
  padding:8px;
}
.ctrl label{
  font-size:11px;
  color:var(--muted);
}
.ctrl input, .ctrl select, .ctrl button{
  width:100%;
}
button{
  background:rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.15);
  color:var(--text);
  border-radius:10px;
  padding:6px;
}
button.primary{
  background:rgba(85,183,255,.25);
  border-color:rgba(85,183,255,.5);
}
</style>
</head>

<body>
<div class="app">

<!-- TOP -->
<div class="topbar">
  <div>
    <b>Swan–Ganz</b>
    <span id="status" class="badge">PA · Balloon OFF</span>
  </div>
  <div>
    HR <b id="hrTop">75</b> bpm
  </div>
</div>

<!-- MAIN -->
<div class="main">

  <!-- CURVA -->
  <div class="wave">
    <div class="wave-label" id="waveLabel">PAP</div>
    <div class="wave-value" id="waveValue">—</div>
    <canvas id="waveCanvas"></canvas>
  </div>

  <!-- SIDE -->
  <div class="side">
    <div class="tile">
      <h3>Flujo</h3>
      <div class="big"><span id="co">5.5</span> L/min</div>
      <div class="mini">CI <span id="ci">3.0</span></div>
      <div class="mini">SvO₂ <span id="svo2">70</span>%</div>
    </div>

    <div class="tile">
      <h3>Presiones</h3>
      <div class="mini">CVP <span id="cvp">4</span> mmHg</div>
      <div class="mini">PCWP <span id="pcwp">10</span> mmHg</div>
      <div class="mini">MPAP <span id="mpap">15</span> mmHg</div>
    </div>

    <div class="tile">
      <h3>Resistencias</h3>
      <div class="mini">SVR <span id="svr">1000</span></div>
      <div class="mini">PVR <span id="pvr">180</span></div>
    </div>
  </div>
</div>

<!-- FOOTER -->
<div class="footer">
  <div class="controls">
    <div class="ctrl">
      <label>Escenario</label>
      <select id="scenario">
        <option value="normal">Normal</option>
        <option value="hypovolemia">Hipovolemia</option>
        <option value="cardio">Shock cardiogénico</option>
        <option value="sepsis">Sepsis temprana</option>
        <option value="tep">TEP</option>
        <option value="tamponade">Taponamiento</option>
      </select>
    </div>
    <div class="ctrl">
      <label>Preload</label>
      <input id="preload" type="range" min="0" max="100" value="55">
    </div>
    <div class="ctrl">
      <label>Contractilidad</label>
      <input id="ino" type="range" min="0" max="100" value="55">
    </div>
    <div class="ctrl">
      <label>SVR</label>
      <input id="svrCtrl" type="range" min="400" max="2200" value="1000">
    </div>
    <div class="ctrl">
      <label>PVR</label>
      <input id="pvrCtrl" type="range" min="80" max="900" value="180">
    </div>
    <div class="ctrl">
      <label>HR</label>
      <input id="hr" type="range" min="40" max="150" value="75">
    </div>
    <div class="ctrl">
      <label>Catéter</label>
      <select id="catPos">
        <option value="RA">RA</option>
        <option value="RV">RV</option>
        <option value="PA" selected>PA</option>
      </select>
    </div>
    <div class="ctrl">
      <label>Balón</label>
      <button id="balloon" class="primary">Inflar / Desinflar</button>
    </div>
    <div class="ctrl">
      <label>Termodilución</label>
      <button id="td">Medir CO</button>
    </div>
  </div>
</div>

</div>

<script>
/* ================= MODELO ================= */
const state={
  preload:55, ino:55, svr:1000, pvr:180, hr:75,
  balloon:false, catPos:"PA",
  vo2:250,
  tdCO:null, tdUntil:0
};

function clamp(x,a,b){return Math.max(a,Math.min(b,x));}

/* ---- fisiología ---- */
function hemo(){
  const cvp=1+state.preload*0.15;
  const pcwp=4+state.preload*0.22;

  let sv=(30+state.preload*0.7)*(0.6+state.ino/100);
  sv-=Math.max(0,(state.svr-1000)/30);
  sv=clamp(sv,20,120);

  let co=sv*state.hr/1000;
  if(pcwp>18) co*=1-(pcwp-18)*0.015;

  const ci=co/1.8;

  let mpap=12+(state.pvr-180)/30+(pcwp-10)*0.45;
  mpap=clamp(mpap,6,50);

  let svo2=70+(co-5.5)*4-(state.vo2-250)/18;
  if(pcwp>18) svo2-=(pcwp-18)*1.2;
  svo2=clamp(svo2,35,85);

  return{cvp,pcwp,sv,co,ci,mpap,svo2};
}

/* ---- qué mide el catéter ---- */
function measured(){
  if(state.balloon){
    if(state.catPos==="PA") return "PCWP";
    return "INVALID";
  }
  return state.catPos==="RA"?"CVP":
         state.catPos==="RV"?"RV":
         "PAP";
}

/* ================= UI ================= */
const $=id=>document.getElementById(id);
const canvas=$("waveCanvas"),ctx=canvas.getContext("2d");
function resize(){
  canvas.width=canvas.clientWidth*devicePixelRatio;
  canvas.height=canvas.clientHeight*devicePixelRatio;
}
window.onresize=resize; resize();

let buffer=new Array(300).fill(0);

function draw(value,label){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  buffer.push(value); buffer.shift();

  ctx.strokeStyle="#55b7ff";
  ctx.lineWidth=2*devicePixelRatio;
  ctx.beginPath();
  buffer.forEach((v,i)=>{
    const x=i/buffer.length*canvas.width;
    const y=canvas.height-(v/40)*canvas.height;
    if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
  });
  ctx.stroke();

  $("waveLabel").textContent=label;
  $("waveValue").textContent=value!==null?value.toFixed(1):"—";
}

/* ================= LOOP ================= */
function update(){
  const h=hemo();
  const wave=measured();

  let v=null,label="INVALID";

  if(wave==="CVP"){v=h.cvp;label="CVP";}
  if(wave==="PAP"){v=h.mpap;label="PAP (mean)";}
  if(wave==="PCWP"){v=h.pcwp;label="PCWP";}
  if(wave==="INVALID"){
    $("status").textContent="⚠️ Balón fuera de PA";
    $("status").classList.add("status-warn");
  } else {
    $("status").textContent=`${state.catPos}${state.balloon?" · WEDGE":""}`;
    $("status").classList.remove("status-warn");
  }

  draw(v,label);

  $("co").textContent=h.co.toFixed(1);
  $("ci").textContent=h.ci.toFixed(1);
  $("svo2").textContent=h.svo2.toFixed(0);
  $("cvp").textContent=h.cvp.toFixed(0);
  $("pcwp").textContent=h.pcwp.toFixed(0);
  $("mpap").textContent=h.mpap.toFixed(0);
  $("svr").textContent=state.svr;
  $("pvr").textContent=state.pvr;
  $("hrTop").textContent=state.hr;

  requestAnimationFrame(update);
}
update();

/* ================= CONTROLS ================= */
$("preload").oninput=e=>state.preload=+e.target.value;
$("ino").oninput=e=>state.ino=+e.target.value;
$("svrCtrl").oninput=e=>state.svr=+e.target.value;
$("pvrCtrl").oninput=e=>state.pvr=+e.target.value;
$("hr").oninput=e=>state.hr=+e.target.value;
$("catPos").onchange=e=>state.catPos=e.target.value;
$("balloon").onclick=()=>state.balloon=!state.balloon;
</script>
</body>
</html>
